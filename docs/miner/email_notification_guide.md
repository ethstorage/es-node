# Email Notification Guide for Proof Submission

This guide describes how to configure and use the email notification feature in EthStorage's mining process. This feature is useful for storage providers or es-node operators who want to receive timely notifications about proof submissions and their results.

---

## SMTP Service Preparation

**You must have access to a working SMTP service to use the email notification feature.**  
If you do not already have an SMTP account, you need to apply for one yourself. Below are two common options:

### Gmail

- You can use your Gmail account as an SMTP sender.
- SMTP Host: `smtp.gmail.com`
- SMTP Port: `587`
- Reference: [Send email from a printer, scanner, or app](https://support.google.com/a/answer/176600?hl=en) (Option 2).

### Mailjet

- [Mailjet](https://app.mailjet.com/signup) is a third-party email service provider that offers free and paid SMTP services.
- SMTP Host: `in-v3.mailjet.com`
- SMTP Port: `587`
- Reference: [How can I configure my SMTP parameters?](https://documentation.mailjet.com/hc/en-us/articles/360043229473-How-can-I-configure-my-SMTP-parameters)

For other providers, refer to their documentation for SMTP host, port, and credential setup.

---


## Email Configuration 

You can configure email notifications via CLI flags or environment variables. The most common way is to pass parameters to your node startup scripts where storage mining is enabled (e.g., `run.sh` or `run-l2.sh`):

```bash
  ...
  --miner.email-username username@gmail.com \
  --miner.email-host smtp.gmail.com \
  --miner.email-port 587 \
  --miner.email-from from@gmail.com \
  --miner.email-to to@gmail.com \
  ...
```
Then execute the script with the SMTP password, miner address, and private key as environment variables:

```bash
env ES_NODE_STORAGE_MINER=0xabc... \
ES_NODE_SIGNER_PRIVATE_KEY=0123... \
ES_NODE_MINER_EMAIL_PASSWORD="abcd  efgh  ijkl  mnop" \
./run.sh
```

## Parameter Reference

| CLI Flag                  | Environment Variable Name           | Description                        |
|---------------------------|-------------------------------------|------------------------------------|
| --miner.email-username    | ES_NODE_MINER_EMAIL_USERNAME        | SMTP username or API key           |
| --miner.email-password    | ES_NODE_MINER_EMAIL_PASSWORD        | SMTP password or API secret        |
| --miner.email-host        | ES_NODE_MINER_EMAIL_HOST            | SMTP server host (default: smtp.gmail.com)|
| --miner.email-port        | ES_NODE_MINER_EMAIL_PORT            | SMTP server port (default: 587)    |
| --miner.email-from        | ES_NODE_MINER_EMAIL_FROM            | Sender email address               |
| --miner.email-to          | ES_NODE_MINER_EMAIL_TO              | Recipient(s), repeated flags supported|

---
**Notes:**

- Keep your SMTP credentials secure.
- It is recommended to use the environment variable (`ES_NODE_MINER_EMAIL_PASSWORD`) for the password.
- If your password contains spaces, enclose it in double quotes.
- To support multiple recipients, use the CLI flag (`--miner.email-to`) repeatedly to assign different email addresses.
- To disable email notifications, simply leave `--miner.email-to` empty.
- The `--miner.email-from` value **must be a valid email address** (no display name or angle brackets).

---

## Example Email Contents

#### Transaction Confirmed and Success

```
Subject: EthStorage Proof Submission: ✅ Success

A storage proof was generated by es-node at 10.20.30.40 for shard 1 at block 12345.

Miner: 0xabc123...
Transaction hash: 0xdef456...

Transaction status: success!
Gas used: 360000
Effective gas price: 1000000000
Reward: 1.000000000
Cost: 0.000360000
Profit: 0.999640000
```

#### Proof Dropped Due to Low Profit

```
Subject: EthStorage Proof Submission: ❌ Failure

A storage proof was generated by es-node for shard 1 at block 12345.

However, it was dropped due to insufficient profit.
```

#### Transaction Submission Failed

```
Subject: EthStorage Proof Submission: ❌ Failure

A storage proof was generated by es-node for shard 1 at block 12345.

However, the mining transaction could not be submitted due to <error message>
```

#### Transaction Submitted but Hash is Empty

```
Subject: EthStorage Proof Submission: ❌ Failure

A storage proof was generated by es-node for shard 1 at block 12345.

However, the mining transaction failed to submit for unclear reasons.
```

#### Transaction Confirmed but Failed

```
Subject: EthStorage Proof Submission: ❌ Failure

A storage proof was generated by es-node for shard 1 at block 12345.

Miner: 0xabc123...
Transaction hash: 0xdef456...

Transaction status: failed!
```

#### Transaction Confirmation Timeout

```
Subject: EthStorage Proof Submission: ❌ Failure

A storage proof was generated by es-node for shard 1 at block 12345.

Miner: 0xabc123...
Transaction hash: 0xdef456...

However, waiting for the transaction confirmation timed out. You can check the transaction status on the block explorer.
```

#### Transaction Receipt Not Found

```
Subject: EthStorage Proof Submission: ❌ Failure

A storage proof was generated by es-node for shard 1 at block 12345.

Miner: 0xabc123...
Transaction hash: 0xdef456...

Unfortunately, the mining transaction receipt was not found.
```
---